name: Stale Issues and PRs

on:
  schedule:
    # Run daily at 1:30 AM UTC
    - cron: '30 1 * * *'
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v9
        with:
          # Issue configuration
          days-before-issue-stale: 60
          days-before-issue-close: 14
          stale-issue-label: 'stale'
          stale-issue-message: |
            This issue has been automatically marked as stale because it has not had recent activity. It will be closed in 14 days if no further activity occurs.

            If this issue is still relevant:
            - Comment with an update on the current status
            - Remove the stale label

            Thank you for your contributions to Transcode!
          close-issue-message: |
            This issue has been automatically closed due to inactivity.

            If you believe this issue is still relevant, please feel free to reopen it with additional context or create a new issue referencing this one.
          exempt-issue-labels: 'pinned,security,priority: critical,priority: high,status: confirmed,status: in progress,status: blocked,good first issue,help wanted'

          # PR configuration
          days-before-pr-stale: 30
          days-before-pr-close: 7
          stale-pr-label: 'stale'
          stale-pr-message: |
            This pull request has been automatically marked as stale because it has not had recent activity. It will be closed in 7 days if no further activity occurs.

            If you're still working on this:
            - Push new commits or comment with a status update
            - Remove the stale label

            Thank you for contributing to Transcode!
          close-pr-message: |
            This pull request has been automatically closed due to inactivity.

            If you'd like to continue working on this, please feel free to reopen or create a new PR.
          exempt-pr-labels: 'pinned,security,status: in progress'

          # General configuration
          remove-stale-when-updated: true
          exempt-assignees: true
          operations-per-run: 30
